## Задача: Исправление кругового импорта в модулях Celery
- **Статус**: Завершена
- **Описание**: Устранение циклической зависимости между app/celery_app.py, app/services/warehouse/manager.py и app/services/allegro/sync_tasks.py
- **Шаги выполнения**:
  - [x] Проанализировать причину кругового импорта
  - [x] Создать план решения с отдельным модулем для общих объектов
  - [x] Обновить документацию (changelog.md, tasktracker.md)
  - [x] Создать app/celery_shared.py с общими объектами
  - [x] Обновить app/celery_app.py - убрать общие объекты, оставить только задачи
  - [x] Обновить app/services/allegro/sync_tasks.py - изменить импорт на celery_shared
  - [x] Код готов к тестированию (пользователь тестирует самостоятельно)
  - [x] Обновить документацию по завершении
- **Зависимости**: нет
- **Примечание**: Решение - создание app/celery_shared.py с общими объектами (celery, SessionLocal, get_allegro_token), что разорвало циклическую зависимость

## Задача: Исправление совместной работы фильтров по остаткам
- **Статус**: Завершена
- **Описание**: Исправление проблемы, когда фильтры по минимальному и максимальному количеству не работали одновременно
- **Шаги выполнения**:
  - [x] Диагностировать проблему с отдельными вызовами .having()
  - [x] Объединить условия фильтрации в один вызов .having() с логическим AND
  - [x] Выявить дополнительную проблему в JavaScript коде
  - [x] Исправить логику передачи параметров на фронтенде
  - [x] Упростить проверки в бэкенде
  - [x] Выявить проблему с пользовательским интерфейсом и логикой ввода
  - [x] Добавить автоматическую коррекцию некорректных значений фильтров
  - [x] Улучшить пользовательский интерфейс фильтров
  - [x] Добавить визуальные подсказки и математические символы
  - [x] Протестировать работу фильтров вместе
  - [x] Обновить changelog
  - [x] Обновить tasktracker
- **Зависимости**: нет
- **Примечание**: Основная проблема была в том, что пользователи путали поля фильтров и вводили значения наоборот. Добавлена автоматическая коррекция и улучшен UI.

## Задача: Расширенные фильтры каталога товаров
- **Статус**: Завершена
- **Описание**: Добавление новых фильтров для каталога товаров: фильтр "больше чем" для остатков и фильтр по бренду через выпадающий список
- **Шаги выполнения**:
  - [x] Создать эндпоинт для получения списка уникальных брендов
  - [x] Добавить параметр brand_filter в эндпоинты каталога
  - [x] Добавить параметр min_stock_filter в UI
  - [x] Обновить фронтенд: добавить выпадающий список брендов
  - [x] Обновить JavaScript для обработки новых фильтров
  - [x] Обновить документацию
- **Зависимости**: нет

## Задача: Автоматическая синхронизация остатков товаров с офферами Allegro
- **Статус**: В процессе
- **Описание**: Реализация системы автоматической синхронизации остатков товаров из локальной базы данных с офферами на всех аккаунтах Allegro при изменении остатков на складе
- **Шаги выполнения**:
  - [x] Реализовать пайплайн Celery задач для массовой синхронизации
  - [x] Добавить rate limiter для соблюдения лимитов API Allegro
  - [x] Реализовать систему уведомлений об ошибках в Telegram
  - [x] Добавить детальное логирование и мониторинг
  - [x] Добавить булевый флаг is_sync_enabled в модель товара и миграцию
  - [x] Реализовать задачу sync_allegro_stock_single_product для синхронизации одного товара по всем аккаунтам (**завершено**)
  - [x] Добавить API endpoint и кнопку в UI для запуска синхронизации одного товара (**завершено**)
  - [x] Исправить ошибку инициализации InventoryManager в Celery задачах (**завершено**)
  - [x] Исправить ошибку 405 Method Not Allowed в API Allegro (**завершено**)
  - [x] Создать таблицу блокировок productsynclock (**завершено**)
  - [ ] Обновить бизнес-логику синхронизации: сначала is_sync_enabled, затем логику с локами (**в процессе**)
  - [ ] Реализовать и интегрировать механизм блокировок (локов) для защиты от дублирующихся обновлений по SKU (**в процессе**)
  - [x] Добавить кнопку в UI карточки товара для ручного включения/отключения синхронизации (**завершено**)
  - [ ] Интегрировать задачу в планировщик Celery Beat (**запланировано**)
- **Зависимости**: нет
