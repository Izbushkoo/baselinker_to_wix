# Требования к редизайну страницы деталей операции

## Введение

Необходимо полностью переделать дизайн страницы деталей операции согласно нарисованному от руки макету. Текущая страница имеет устаревший дизайн и не соответствует новым требованиям к UX. Новый дизайн должен быть более компактным, информативным и удобным для пользователя, с сохранением серой стилистики и цветовой схемы.

## Требования

### Требование 1

**Пользовательская история:** Как пользователь системы, я хочу видеть компактную и информативную шапку страницы деталей операции, чтобы быстро получать основную информацию о статусе операции.

#### Критерии приемки

1. КОГДА пользователь открывает страницу деталей операции, ТО система ДОЛЖНА отображать шапку с кнопкой "Назад", заголовком, иконкой разворачивания и статусом списания
2. КОГДА пользователь нажимает кнопку "Назад", ТО система ДОЛЖНА выполнить браузерную логику возврата на предыдущую страницу
3. КОГДА пользователь нажимает на иконку треугольника в шапке, ТО система ДОЛЖНА разворачивать/сворачивать детали операции
4. КОГДА система получает статус is_stock_updated от микросервиса, ТО система ДОЛЖНА отображать статус "Списано" или "Не списано" в правой части шапки

### Требование 2

**Пользовательская история:** Как пользователь системы, я хочу видеть детальную информацию об операции в развернутом виде, чтобы получать полную картину о заказе и его обработке.

#### Критерии приемки

1. КОГДА пользователь разворачивает детали операции, ТО система ДОЛЖНА отображать поля: ID заказа, Аккаунт, Статус заказа, Статус операции, Обновлено, Следующая попытка, Количество попыток
2. КОГДА пользователь нажимает на ID заказа, ТО система ДОЛЖНА копировать ID в буфер обмена
3. КОГДА система отображает статус заказа, ТО система ДОЛЖНА показывать только релевантные статусы согласно жизненному циклу: BOUGHT → FILLED_IN → READY_FOR_PROCESSING → SENT
4. ЕСЛИ статус fulfillment.status равен CANCELLED, ТО система ДОЛЖНА отображать "Отменен продавцом" в приоритете над основными статусами
5. ЕСЛИ основной статус равен CANCELLED, ТО система ДОЛЖНА отображать "Отменен покупателем"
6. КОГДА операция имеет поле stock_deducted_at, ТО система ДОЛЖНА отображать дату и время списания стока
7. КОГДА операция отменена, ТО система ДОЛЖНА отображать информацию о том, кем была отменена операция

### Требование 3

**Пользовательская история:** Как пользователь системы, я хочу иметь быстрый доступ к основным действиям с операцией, чтобы эффективно управлять процессом списания.

#### Критерии приемки

1. КОГДА пользователь просматривает детали операции, ТО система ДОЛЖНА отображать кнопки: "Провести операцию списания", "Отменить операцию списания", "Товары"
2. КОГДА пользователь нажимает "Провести операцию списания", ТО система ДОЛЖНА выполнить ту же логику, что и текущая кнопка "Списать"
3. КОГДА пользователь нажимает "Товары", ТО система ДОЛЖНА выполнить ту же логику, что и текущая кнопка "Открыть товары"
4. КОГДА пользователь нажимает "Отменить операцию списания", ТО система ДОЛЖНА показать заглушку (функционал будет реализован позже)

### Требование 4

**Пользовательская история:** Как пользователь системы, я хочу видеть товары с ошибками валидации в отдельном блоке, чтобы быстро идентифицировать проблемные позиции.

#### Критерии приемки

1. КОГДА в операции есть товары с ошибками валидации, ТО система ДОЛЖНА отображать блок "Ошибка" с карточками проблемных товаров
2. КОГДА система отображает карточку товара с ошибкой, ТО система ДОЛЖНА показывать: изображение товара, SKU (копируемый), параметры "Доступно", "Требуется", "Нехватка"
3. КОГДА пользователь нажимает на SKU товара, ТО система ДОЛЖНА копировать SKU в буфер обмена
4. КОГДА нет товаров с ошибками валидации, ТО система НЕ ДОЛЖНА отображать блок "Ошибка"

### Требование 5

**Пользовательская история:** Как пользователь системы, я хочу видеть товары заказа в компактной таблице с возможностью прокрутки, чтобы эффективно просматривать все позиции заказа.

#### Критерии приемки

1. КОГДА пользователь просматривает детали операции, ТО система ДОЛЖНА отображать разворачивающийся блок "Товары заказа"
2. КОГДА блок "Товары заказа" свернут, ТО система ДОЛЖНА показывать только заголовок блока
3. КОГДА пользователь разворачивает блок "Товары заказа", ТО система ДОЛЖНА отображать контейнер фиксированной высоты со скроллящейся таблицей
4. КОГДА система отображает таблицу товаров, ТО система ДОЛЖНА показывать колонки: SKU, Название, Цена за ед., Кол-во, Цена
5. КОГДА система отображает таблицу в половину экрана, ТО заголовки и данные НЕ ДОЛЖНЫ наплывать друг на друга
6. КОГДА система отображает итоги заказа, ТО система ДОЛЖНА показывать стоимость доставки и итоговую сумму заказа внизу справа от таблицы
7. КОГДА цена за все товары не указана в данных заказа, ТО система ДОЛЖНА рассчитывать ее для отображения в таблице

### Требование 6

**Пользовательская история:** Как пользователь системы, я хочу видеть логи операции в компактном формате с возможностью разворачивания деталей, чтобы отслеживать историю обработки операции.

#### Критерии приемки

1. КОГДА пользователь просматривает детали операции, ТО система ДОЛЖНА отображать блок "Логи" с записями из StockSynchronizationLog
2. КОГДА система отображает логи, ТО система ДОЛЖНА показывать их в скроллящемся контейнере фиксированной высоты
3. КОГДА система отображает запись лога, ТО система ДОЛЖНА показывать: статус, timestamp, action
4. КОГДА пользователь нажимает на строку лога, ТО система ДОЛЖНА разворачивать детали логирования мелким текстом
5. КОГДА система отображает развернутые детали лога, ТО система ДОЛЖНА показывать полную информацию из поля details

### Требование 7

**Пользовательская история:** Как пользователь системы, я хочу сохранить привычную функциональность текущей страницы, чтобы не потерять возможности работы с операциями.

#### Критерии приемки

1. КОГДА пользователь взаимодействует с новым дизайном, ТО вся существующая логика открытия и закрытия товаров ДОЛЖНА остаться неизменной
2. КОГДА пользователь использует функции копирования, ТО система ДОЛЖНА сохранить текущую логику копирования в буфер обмена
3. КОГДА пользователь работает с кнопками действий, ТО система ДОЛЖНА выполнять те же операции, что и в текущей реализации
4. КОГДА система отображает статусы и данные, ТО система ДОЛЖНА использовать ту же логику обработки данных, что и в текущей версии